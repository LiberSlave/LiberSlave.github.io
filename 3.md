
## D3.js 로 차트만들기


chartRenderer.js의 차트 만드는 기능은 클래스로 구현되었다.
나는 여러개의 차트를 한 화면에 띄우는게 목표였고 이는 여러개의 독립적인 인스턴스를 만들어서 구현할 수 있기 때문이다. 

가장먼저 dialog.js의 displayChartsInDialog 함수를 알아보자.

 displayChartsInDialog(chartDataFromServer) 함수의 인자로 들어가는 chartData는 다음과 같은 
 key value값이 들어있는 객체임을 알 수 있다. 
 
![[Pasted image 20250602133903.png]]



### Echarts로 라이브러리 변경

D3.js가 매우 강력한 커스터마이징이 가능하고 로우레벨에서 개발할 수 있다고 해서 이 라이브러리로 시작을했는데 막상 차트를 구현해놓고 줌/팬 과같은 인터렉티브 기능을 구현해보니 쓸 수 가없다....
기능이 안되는것은 아니다. 근데 렉이 너무 많이 먹는다... 이유를 찾아보니 D3.js는 차트의 봉 하나하나를 `<svg>`라는 태그로 하나의 DOM으로 표시하고 내 분봉차트는 수천개의 봉이 존재하기에 이런 태그가 엄청나게 많아지고, 후에 줌인 줌아웃을 할때에는 이 태그들을 전부 삭제했다가 생성하는 방식으로 줌이 구현 될수 밖에 없어서 렉이 먹을 수 밖에 없는 구조이다. 

즉, `<svg>`를 근본으로 하여 빌드업된 라이브러리는 현재 내가 사용하면 안되는 라이브러리들이다.

여러 다른 라이브러리를 찾아보다가 lightweight같은 tradingview라는 회사에서 제공하는 오픈소스 라이브러리가 있는데 이를 통해 간단한 예제를 구현해본 결과 줌인,줌아웃 팬 같은 인터렉티브 기능이 굉장히 부드럽게 구현되었다. 
이에 대해 더 조사해보니 canvas기반으로 렌더링이 되기 때문에 수천개의 데이터로 이루어진 봉에서 줌/팬 기능을 구현할때 렉이 덜 먹게 되는것이다.
캔버스 방식은 그래픽을 픽셀 단위로 직접 그려 화면에 표시하는 방식이다. 
이는 수많은 DOM 요소를 생성하고 관리하는 svg와 근본적으로 다르다. 

gemini피셜
따라서 수천 개의 데이터로 이루어진 차트에서 줌/팬 기능을 실행할 때, 캔버스 방식은 **전체 차트 영역을 하나의 그림판처럼 취급하여 필요한 부분만 다시 그립니다.** 이는 수많은 DOM 요소를 일일이 수정하거나 재생성하는 과정에서 발생하는 브라우저의 부담을 크게 줄여주므로, 결과적으로 훨씬 부드럽고 반응성이 뛰어난 사용자 경험을 제공하며 '렉' 현상을 최소화할 수 있습니다."


즉 이 canvas기반으로 렌더링이 되도록 구현한 라이브러리를 찾아서 써야한다.
그래서 쓸만한 두개의 라이브러리를 찾았는데 **TradingView Lightweight Charts**와  **ECharts** 이다.
그중에서 멀티패널이 지원되는 ECharts를 사용하기로 했다.(나는 거래량, 거래대금을 표시하는것을 원함.)

| 라이브러리                              | 라이선스                | 내장 지표/드로잉                   | 멀티 패널 (Pane)     | 줌·팬·툴팁       | 주 사용층/포지션                                  |
| ---------------------------------- | ------------------- | --------------------------- | ---------------- | ------------ | ------------------------------------------ |
| **TradingView Advanced Charts**    | 공개 웹사이트 무료 / 비공개 유료 | ✓ 매우 풍부                     | ✓ 지원             | ✓ (완벽)       | 엔터프라이즈용, 플랫폼 구축 시 최우선 선택                   |
| **TradingView Lightweight Charts** | Apache 2.0 (완전 무료)  | ✗(없음)                       | 제한적 (pane 없음)    | ✓ (기본)       | “가볍게 캔들/볼륨+툴팁/줌” 정도만 필요할 때                 |
| **Highcharts Stock**               | 상업용 / 비상업 무료        | ✓ 기본 지표 모듈 제공               | ✓ 지원             | ✓ (완벽)       | 재무 차트 시장에서 널리 사용, 커스터마이징 용이                |
| **amCharts Stock Chart**           | 상업용 / 비상업 무료        | ✓ 기본 지표 포함하지 않음 (ex. 이동평균만) | ✓ 지원             | ✓ (애니메이션 강점) | 디자인 퀄리티가 뛰어나며, UX 중심 차트가 필요할 때             |
| **ApexCharts**                     | AGPL / 상업용          | ✗(직접 구현 필요)                 | 제한적 (pane 간접 구성) | ✓ (기본)       | React/Vue/Angular 기반 SPA에서 간편히 주가 차트 구현할 때 |
| **ECharts**                        | Apache 2.0          | ✗(직접 구현 필요)                 | ✓ 가능 (grid로 구성)  | ✓ (기본)       | 완전 무료 오픈소스, 커뮤니티 자료 많음, 중국·아시아권에 인기        |
| **ChartIQ (Commercial)**           | 엔터프라이즈 전용           | ✓ 매우 풍부                     | ✓ 지원             | ✓ (완벽)       | 금융기관 전용, 호가창·주문연동 등 최고 수준의 트레이딩 기능 필요 시    |


#### 차트 구현 결과물

![[Pasted image 20250603195432.png]]
![[Pasted image 20250603195447.png]]

